<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥—Ä–µ–π—Ñ—É –ë–ü–õ–ê</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #fff;
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 5px;
            color: #60a5fa;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 0.95em;
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .card h2 {
            font-size: 1.1em;
            margin-bottom: 12px;
            color: #60a5fa;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 12px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 0.85em;
            margin-bottom: 5px;
            color: #cbd5e1;
        }

        input[type="number"] {
            padding: 8px 10px;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 6px;
            color: #fff;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #60a5fa;
        }

        .hint {
            font-size: 0.75em;
            color: #94a3b8;
            margin-top: 3px;
        }

        .result-box {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            border: 1px solid #3b82f6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .result-box h2 {
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #fff;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            background: rgba(30, 58, 138, 0.4);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 0.9em;
        }

        .result-value {
            font-weight: bold;
            color: #fbbf24;
        }

        #map {
            height: 500px;
            width: 100%;
            border-radius: 10px;
            border: 2px solid #334155;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            padding: 10px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.85em;
            color: #cbd5e1;
        }

        .coords-display {
            background: rgba(15, 23, 42, 0.7);
            padding: 8px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85em;
        }

        .copyright-box {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .copyright-box a {
            color: #FFF;
        }
        
        .copyright-box a:hover {
            color: #FFD679;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }
            
            .input-row {
                grid-template-columns: 1fr;
            }

            #map {
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ∏ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥—Ä–µ–π—Ñ—É –ë–ü–õ–ê</h1>
            <p class="subtitle">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑–Ω–æ—Å—É –¥—Ä–æ–Ω–∞ –≤—ñ—Ç—Ä–æ–º –∑ –∫–∞—Ä—Ç–æ—é</p>
        </header>

        <!-- –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ -->
        <div class="card">
            <h2>üìù –í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ</h2>
            <div class="input-row">
                <div class="input-group">
                    <label for="windDir">–ù–∞–ø—Ä—è–º–æ–∫ –≤—ñ—Ç—Ä—É (Ai¬∞)</label>
                    <input type="number" id="windDir" min="0" max="360" value="90">
                    <div class="hint" id="windDirHint">–î–º–µ –∑—ñ –°—Ö–æ–¥—É ‚Üí –Ω–∞ –ó–∞—Ö—ñ–¥</div>
                </div>
                <div class="input-group">
                    <label for="windSpeed">–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ—Ç—Ä—É (–º/—Å)</label>
                    <input type="number" id="windSpeed" min="0" max="50" step="0.1" value="5">
                    <div class="hint" id="windSpeedHint">–ü–æ–º—ñ—Ä–Ω–∏–π</div>
                </div>
                <div class="input-group">
                    <label for="battery">–ó–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ—ó (%)</label>
                    <input type="number" id="battery" min="0" max="100" value="100">
                    <div class="hint" id="batteryHint">–ß–∞—Å –ø–æ–ª—å–æ—Ç—É: 36.0 —Ö–≤</div>
                </div>
            </div>
            
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ -->
        <div class="result-box">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥—Ä–µ–π—Ñ—É</h2>
            <div id="results"></div>
            <div class="coords-display" id="coordsDisplay"></div>
        </div>

        <!-- –ö–∞—Ä—Ç–∞ -->
        <div class="card">
            <h2>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –¥—Ä–µ–π—Ñ—É</h2>
            <div id="map"></div>
            <div class="info-box" style="margin-top: 10px;">
                üí° –ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –∫–∞—Ä—Ç—ñ, —â–æ–± –≤–∫–∞–∑–∞—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—É —Ç–æ—á–∫—É –ø–æ–ª—å–æ—Ç—É
            </div>
        </div>

        <div class="info-box">
            ‚ÑπÔ∏è –ú–µ—Ç–µ–æ—Ä–æ–ª–æ–≥—ñ—á–Ω–∏–π –Ω–∞–ø—Ä—è–º–æ–∫ –ø–æ–∫–∞–∑—É—î –ó–í–Ü–î–ö–ò –¥–º–µ –≤—ñ—Ç–µ—Ä. –í—ñ—Ç–µ—Ä 90¬∞ –¥–º–µ –ó–Ü –°—Ö–æ–¥—É –ù–ê –ó–∞—Ö—ñ–¥.
        </div>

        <div class="copyright-box">
			<div class="copyright-box_link"><a href="https://github.com/pekarskyi/uav-drift-calculator">–°—Ç–æ—Ä—ñ–Ω–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞</a></div>
			<div class="copyright-box_author">–ê–≤—Ç–æ—Ä <a href="https://github.com/pekarskyi/">Reset</a>, v.1.0.0</div>
		</div>
        
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const MAX_FLIGHT_TIME = 36;

        const elements = {
            windDir: document.getElementById('windDir'),
            windSpeed: document.getElementById('windSpeed'),
            battery: document.getElementById('battery')
        };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏ (—Ü–µ–Ω—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏)
        const map = L.map('map').setView([49.0, 31.5], 6);
        
        // –ë–∞–∑–æ–≤—ñ —à–∞—Ä–∏
        const streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        });

        const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles ¬© Esri',
            maxZoom: 19
        });

        const hybrid = L.layerGroup([
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles ¬© Esri',
                maxZoom: 19
            }),
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_only_labels/{z}/{x}/{y}{r}.png', {
                attribution: '¬© CARTO',
                maxZoom: 19,
                opacity: 0.8
            })
        ]);

        // –î–æ–¥–∞—î–º–æ hybrid –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
        hybrid.addTo(map);

        // –ö–æ–Ω—Ç—Ä–æ–ª—å —à–∞—Ä—ñ–≤
        const baseMaps = {
            "üõ∞Ô∏è –°—É–ø—É—Ç–Ω–∏–∫ + –ø—ñ–¥–ø–∏—Å–∏": hybrid,
            "üõ∞Ô∏è –°—É–ø—É—Ç–Ω–∏–∫": satellite,
            "üó∫Ô∏è –ö–∞—Ä—Ç–∞": streets
        };

        L.control.layers(baseMaps).addTo(map);

        let startMarker = null;
        let endMarker = null;
        let driftLine = null;
        let windArrow = null;
        let startLatLng = null;

        function getWindDirection(deg) {
            const directions = [
                { angle: 0, from: '–ü—ñ–≤–Ω—ñ—á', to: '–ü—ñ–≤–¥–µ–Ω—å', arrow: '‚Üì' },
                { angle: 45, from: '–ü–Ω-–°—Ö', to: '–ü–¥-–ó—Ö', arrow: '‚Üô' },
                { angle: 90, from: '–°—Ö—ñ–¥', to: '–ó–∞—Ö—ñ–¥', arrow: '‚Üê' },
                { angle: 135, from: '–ü–¥-–°—Ö', to: '–ü–Ω-–ó—Ö', arrow: '‚Üñ' },
                { angle: 180, from: '–ü—ñ–≤–¥–µ–Ω—å', to: '–ü—ñ–≤–Ω—ñ—á', arrow: '‚Üë' },
                { angle: 225, from: '–ü–¥-–ó—Ö', to: '–ü–Ω-–°—Ö', arrow: '‚Üó' },
                { angle: 270, from: '–ó–∞—Ö—ñ–¥', to: '–°—Ö—ñ–¥', arrow: '‚Üí' },
                { angle: 315, from: '–ü–Ω-–ó—Ö', to: '–ü–¥-–°—Ö', arrow: '‚Üò' },
                { angle: 360, from: '–ü—ñ–≤–Ω—ñ—á', to: '–ü—ñ–≤–¥–µ–Ω—å', arrow: '‚Üì' }
            ];

            for (let i = 0; i < directions.length - 1; i++) {
                if (deg >= directions[i].angle && deg < directions[i + 1].angle) {
                    if (Math.abs(deg - directions[i].angle) < Math.abs(deg - directions[i + 1].angle)) {
                        return directions[i];
                    } else {
                        return directions[i + 1];
                    }
                }
            }
            return directions[0];
        }

        function getWindDescription(speed) {
            if (speed < 2) return '–°–ª–∞–±–∫–∏–π';
            if (speed < 6) return '–ü–æ–º—ñ—Ä–Ω–∏–π';
            if (speed < 11) return '–°–∏–ª—å–Ω–∏–π';
            if (speed < 17) return '–î—É–∂–µ —Å–∏–ª—å–Ω–∏–π';
            return '–®—Ç–æ—Ä–º–æ–≤–∏–π';
        }

        function updateValues() {
            const windDir = Number(elements.windDir.value);
            const windSpeed = Number(elements.windSpeed.value);
            const battery = Number(elements.battery.value);
            
            const windInfo = getWindDirection(windDir);
            document.getElementById('windDirHint').textContent = `–î–º–µ –∑ ${windInfo.from} ${windInfo.arrow} –Ω–∞ ${windInfo.to}`;
            document.getElementById('windSpeedHint').textContent = getWindDescription(windSpeed);
            
            const flightTime = (battery / 100) * MAX_FLIGHT_TIME;
            document.getElementById('batteryHint').textContent = `–ß–∞—Å –ø–æ–ª—å–æ—Ç—É: ${flightTime.toFixed(1)} —Ö–≤`;
            
            calculate();
        }

        function calculate() {
            const windDir = Number(elements.windDir.value);
            const windSpeed = Number(elements.windSpeed.value);
            const battery = Number(elements.battery.value);

            const availableTime = (battery / 100) * MAX_FLIGHT_TIME;
            const driftDistance = windSpeed * availableTime * 60; // –º–µ—Ç—Ä—ñ–≤
            const driftDirection = (windDir + 180) % 360;

            displayResults({
                driftDistance,
                driftDirection,
                availableTime,
                windSpeed
            });

            if (startLatLng) {
                updateMapMarkers(driftDistance, driftDirection, windDir);
            }
        }

        function displayResults(data) {
            const driftDir = getWindDirection(data.driftDirection);
            
            const resultsHTML = `
                <div class="result-item">
                    <span>–î—Ä–µ–π—Ñ –∑–∞ ${data.availableTime.toFixed(1)} —Ö–≤:</span>
                    <span class="result-value">${data.driftDistance.toFixed(0)} –º (${(data.driftDistance / 1000).toFixed(2)} –∫–º)</span>
                </div>
                <div class="result-item">
                    <span>–ù–∞–ø—Ä—è–º–æ–∫ –¥—Ä–µ–π—Ñ—É (Ai):</span>
                    <span class="result-value">${data.driftDirection}¬∞</span>
                </div>
                <div class="result-item">
                    <span>–®–≤–∏–¥–∫—ñ—Å—Ç—å –¥—Ä–µ–π—Ñ—É:</span>
                    <span class="result-value">${data.windSpeed.toFixed(1)} –º/—Å</span>
                </div>
            `;
            document.getElementById('results').innerHTML = resultsHTML;
        }

        function calculateEndPoint(startLat, startLng, distance, bearing) {
            const R = 6371000; // –†–∞–¥—ñ—É—Å –ó–µ–º–ª—ñ –≤ –º–µ—Ç—Ä–∞—Ö
            const lat1 = startLat * Math.PI / 180;
            const lon1 = startLng * Math.PI / 180;
            const brng = bearing * Math.PI / 180;
            
            const lat2 = Math.asin(Math.sin(lat1) * Math.cos(distance / R) +
                        Math.cos(lat1) * Math.sin(distance / R) * Math.cos(brng));
            
            const lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(distance / R) * Math.cos(lat1),
                                 Math.cos(distance / R) - Math.sin(lat1) * Math.sin(lat2));
            
            return {
                lat: lat2 * 180 / Math.PI,
                lng: lon2 * 180 / Math.PI
            };
        }

        function updateMapMarkers(driftDistance, driftDirection, windDir) {
            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä—ñ –º–∞—Ä–∫–µ—Ä–∏
            if (endMarker) map.removeLayer(endMarker);
            if (driftLine) map.removeLayer(driftLine);
            if (windArrow) map.removeLayer(windArrow);

            // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É
            const endPoint = calculateEndPoint(
                startLatLng.lat,
                startLatLng.lng,
                driftDistance,
                driftDirection
            );

            // –ö—ñ–Ω—Ü–µ–≤–∏–π –º–∞—Ä–∫–µ—Ä
            endMarker = L.marker([endPoint.lat, endPoint.lng], {
                icon: L.divIcon({
                    className: 'custom-icon',
                    html: '<div style="background: #ef4444; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white;"></div>',
                    iconSize: [20, 20]
                })
            }).addTo(map).bindPopup(`<b>–ö—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ –ø—ñ—Å–ª—è –¥—Ä–µ–π—Ñ—É</b><br>
                Lat: ${endPoint.lat.toFixed(6)}<br>
                Lng: ${endPoint.lng.toFixed(6)}`);

            // –õ—ñ–Ω—ñ—è –¥—Ä–µ–π—Ñ—É
            driftLine = L.polyline([
                [startLatLng.lat, startLatLng.lng],
                [endPoint.lat, endPoint.lng]
            ], {
                color: '#f59e0b',
                weight: 3,
                opacity: 0.8
            }).addTo(map);

            // –°—Ç—Ä—ñ–ª–∫–∞ –≤—ñ—Ç—Ä—É (–∫–æ—Ä–æ—Ç–∫–∞, –ø–æ–∫–∞–∑—É—î –∑–≤—ñ–¥–∫–∏ –¥–º–µ)
            const windPoint = calculateEndPoint(
                startLatLng.lat,
                startLatLng.lng,
                Math.min(driftDistance * 0.3, 500),
                windDir
            );

            windArrow = L.polyline([
                [startLatLng.lat, startLatLng.lng],
                [windPoint.lat, windPoint.lng]
            ], {
                color: '#06b6d4',
                weight: 2,
                opacity: 0.7,
                dashArray: '8, 4'
            }).addTo(map);

            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            document.getElementById('coordsDisplay').innerHTML = `
                <strong>–ü–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–æ—á–∫–∞:</strong> ${startLatLng.lat.toFixed(6)}, ${startLatLng.lng.toFixed(6)}<br>
                <strong>–ö—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞:</strong> ${endPoint.lat.toFixed(6)}, ${endPoint.lng.toFixed(6)}
            `;

            // –ü—ñ–¥–≥–∞–Ω—è—î–º–æ –º–∞—Å—à—Ç–∞–± –∫–∞—Ä—Ç–∏
            map.fitBounds([
                [startLatLng.lat, startLatLng.lng],
                [endPoint.lat, endPoint.lng]
            ], { padding: [50, 50] });
        }

        // –û–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –Ω–∞ –∫–∞—Ä—Ç—ñ
        map.on('click', function(e) {
            startLatLng = e.latlng;
            
            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —Å—Ç–∞—Ä—Ç–æ–≤–∏–π –º–∞—Ä–∫–µ—Ä
            if (startMarker) map.removeLayer(startMarker);
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Å—Ç–∞—Ä—Ç–æ–≤–∏–π –º–∞—Ä–∫–µ—Ä
            startMarker = L.marker([e.latlng.lat, e.latlng.lng], {
                icon: L.divIcon({
                    className: 'custom-icon',
                    html: '<div style="background: #22c55e; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white;"></div>',
                    iconSize: [20, 20]
                })
            }).addTo(map).bindPopup(`<b>–ü–æ—á–∞—Ç–∫–æ–≤–∞ —Ç–æ—á–∫–∞</b><br>
                Lat: ${e.latlng.lat.toFixed(6)}<br>
                Lng: ${e.latlng.lng.toFixed(6)}`);
            
            calculate();
        });

        elements.windDir.addEventListener('input', updateValues);
        elements.windSpeed.addEventListener('input', updateValues);
        elements.battery.addEventListener('input', updateValues);

        updateValues();
    </script>
</body>

</html>

